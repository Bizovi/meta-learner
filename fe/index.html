
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Checkout example for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

  </head>

  <body class="bg-light">


    <div class="container">
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="../../assets/brand/bootstrap-solid.svg" alt="" width="72" height="72">
        <h2>Add bookmark</h2>
      </div>

      <div class="row">
        <div class="col-md-12 order-md-1">
          <form id="addBookmarkForm" class="needs-validation" novalidate>

            <div class="mb-3">
              <input type="text" class="form-control" id="url" placeholder="http://">
            </div>
            <button class="btn btn-primary btn-lg btn-block" type="submit">Add</button>
          </form>
        </div>
      </div>


      <div class="container">
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="../../assets/brand/bootstrap-solid.svg" alt="" width="72" height="72">
        <h2>Bookmarks</h2>
      </div>

      <div class="row">
        <div class="col-md-12 order-md-1">
            <ul class="list-group" id="list">
            </ul>
        </div>
      </div>




        <div class="container">
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="../../assets/brand/bootstrap-solid.svg" alt="" width="72" height="72">
        <h2>Add goal</h2>
      </div>

      <div class="row">
        <div class="col-md-12 order-md-1">
          <form id="addGoalForm" class="needs-validation" novalidate>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" name="name" placeholder="Master MATH" value="" required>

              </div>
              <div class="col-md-6 mb-3">
                <label for="timespan">Timespan</label>
                <input type="number" class="form-control" name="timespan" id="timespan" placeholder="Total number of hours" value="" required>
              </div>
            </div>


              <div class="mb-3">
          <div class="progress" style="height: 3px;">
              <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

              <div class="row">
              <table class="table">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Bookmark</th>
      <th scope="col">Reading time</th>
    </tr>
  </thead>
  <tbody id="goalBookmarks">

  </tbody>
</table>

              </div>

              </div>

            <button class="btn btn-primary btn-lg btn-block" type="submit">Add</button>
          </form>
        </div>
      </div>




      <div class="container">
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="../../assets/brand/bootstrap-solid.svg" alt="" width="72" height="72">
        <h2>Goals</h2>
      </div>

      <div class="row">
        <div class="col-md-12 order-md-1">
            <ul class="list-group" id="goals">
            </ul>
        </div>
      </div>


        <div class="container">
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="../../assets/brand/bootstrap-solid.svg" alt="" width="72" height="72">
        <h2 id="goalName"></h2>
      </div>

      <div class="row">
        <div class="col-md-12 order-md-1">
          <form id="openGoalForm" class="needs-validation" novalidate>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="openGoalName" name="name" placeholder="Master MATH" value="">

              </div>
              <div class="col-md-6 mb-3">
                <label for="timespan">Timespan</label>
                <input type="number" class="form-control" name="timespan" id="openGoalTimespan" placeholder="Total number of hours" value="">
              </div>
            </div>


              <div class="mb-3">
          <div class="progress" style="height: 3px;">
              <div class="progress-bar" id="openGoalProgressBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

              <div class="row">
              <table class="table">
  <thead>
    <tr>
      <th scope="col">Bookmark</th>
      <th scope="col">Reading time</th>
      <th scope="col">Read</th>
    </tr>
  </thead>
  <tbody id="openGoalBookmarks">

  </tbody>
</table>

              </div>

              </div>

            <button class="btn btn-primary btn-lg btn-block" type="submit">Update</button>
          </form>
        </div>
      </div>



    <!--<div class="container">-->
      <!--<div class="py-5 text-center">-->
        <!--<img class="d-block mx-auto mb-4" src="../../assets/brand/bootstrap-solid.svg" alt="" width="72" height="72">-->
        <!--<h2>Add category</h2>-->
      <!--</div>-->

      <!--<div class="row">-->
        <!--<div class="col-md-12 order-md-1">-->
          <!--<form id="addCategoryForm" class="needs-validation" novalidate>-->
              <!--<div class="row">-->
              <!--<div class="col-md-6 mb-3" style="display: none">-->
                <!--<label for="parent">Parent</label>-->
                  <!--<select id="parent" class="form-control">-->
                      <!--<option value="0">None</option>-->
                  <!--</select>-->
                <!--<div class="invalid-feedback">-->
                  <!--Valid first name is required.-->
                <!--</div>-->
              <!--</div>-->
              <!--<div class="col-md-6 mb-3">-->
                <!--<label for="category">Name</label>-->
                <!--<input type="text" class="form-control" id="category" placeholder="Math" value="" required>-->
                <!--<div class="invalid-feedback">-->
                  <!--Valid last name is required.-->
                <!--</div>-->
              <!--</div>-->
            <!--</div>-->

            <!--<button class="btn btn-primary btn-lg btn-block" type="submit">Add</button>-->
          <!--</form>-->
        <!--</div>-->
      <!--</div>-->


      <footer class="my-5 pt-5 text-muted text-center text-small">
        <p class="mb-1">&copy; 2017-2018 MetaLearner</p>
      </footer>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
        $( document ).ready(function() {
            var baseUrl = 'http://localhost:8181/';
            $("#addBookmarkForm").on('submit', function (e) {
                e.preventDefault();

                addBookmark($(this).find('#url').first().val());
            });

            addBookmark = function(url) {
                request = {
                    'url': url
                }

                url = baseUrl + 'article';

                $.ajax({
                    type: "POST",
                    url: url,
                    data: JSON.stringify(request),
                    dataType: 'json',
                    contentType: 'application/json'
                });
            }

            $("#addCategoryForm").on('submit', function (e) {
                e.preventDefault();

                addCategory($(this).find('#category').first().val());
            });

            addCategory = function(category) {
                request = {
                    'category': category
                }

                url = baseUrl + 'addCategory';

                $.ajax({
                    type: "POST",
                    url: url,
                    data: JSON.stringify(request),
                    dataType: 'json',
                    contentType: 'application/json'
                });
            }

            getCategories = function () {
                url = baseUrl + 'categories';
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: 'json',
                    success: function (response) {
                        defaultOption = '<option value=0>None</option>';
                        var parent = $('#parent');
                        parent.html(defaultOption);

                        response.forEach(function (category) {
                            parent.append('<option value=' + category.id + '>' + category.name + '</option>');
                        })
                    },
                    contentType: 'application/json'
                });
            }

            getCategories();

            var getBookmarks = function(success) {
                url = baseUrl + 'article/get'

                $.ajax({
                    type: "GET",
                    url: url,
                    success: success,
                    dataType: 'json',
                    contentType: 'application/json'
                })
            }

            getBookmarks(function (response) {
                var list = $('#list')
                // var select = $('#goalBookmarks');
                var table = $('#goalBookmarks');

                response.forEach(function (article) {
                   $(list).append('<li class="list-group-item"><a href="' + article.url + '" target="_blank">' + article.title +  '</a></li>');
                   // $(select).append('<option value="' + article.id + '">' + article.title + '</option>');


                    $(table).append('<tr><td><input type="checkbox" name="bookmarks[]" value="' + article.id + '" ml-duration="' + article.reading_time + '"></td><td>' + article.title + '</td><td>' + article.reading_time + '</td></tr>')

                });
            });

             var getGoals = function(success) {
                url = baseUrl + 'goals/get'

                $.ajax({
                    type: "GET",
                    url: url,
                    success: success,
                    dataType: 'json',
                    contentType: 'application/json'
                })
            }

            openGoal = function (id) {
                 url = baseUrl + 'goals/get/' + id

                $.ajax({
                    type: "GET",
                    url: url,
                    success: function (goal) {
                        $('#goalName').html(goal.name);
                        $('#openGoalName').val(goal.name);
                        $('#openGoalTimespan').val(goal.timespan);
                        goal.bookmarks.forEach(function (article) {
                            $('#openGoalBookmarks').append('<tr><td>' + article.title + '</td><td>' + article.reading_time + '</td><td><input type="checkbox" name="read[]" value="' + article.id + '" ml-duration="' + article.reading_time + '"></td></tr>')

                        });
                    },
                    dataType: 'json',
                    contentType: 'application/json'
                })
            }

             getGoals(function (response) {
                var list = $('#goals')

                response.forEach(function (goal) {
                   $(list).append('<li class="list-group-item"><a onclick="openGoal(' + goal.id + ')" target="_blank">' + goal.name +  ' (<b>' + goal.timespan + '</b> hours) </a></li>');
                });
            });


            $('body').on('click', '#addGoalForm td', function () {
                var checkbox = $(this).parents('tr').find('input');
                checkbox.prop('checked', ! checkbox.prop('checked'));

                progressBar()
            });



            $('body').on('click', '#openGoalBookmarks td', function () {
                var checkbox = $(this).parents('tr').find('input');
                checkbox.prop('checked', ! checkbox.prop('checked'));

                goalProgressBar();
            });


            var goalProgressBar = function () {
                var timespan = parseInt($('#openGoalTimespan').val());
                var readDuration = 0;
                $('#openGoalBookmarks').find('input:checked').each(function (i, input) {
                   duration = $(input).attr('ml-duration');
                    readDuration += parseInt(duration);
                });

                percentage = (readDuration / timespan) * 100;

                drawProgressBar('#openGoalProgressBar', percentage)
            }

            var drawProgressBar = function(id, percentage) {
                 $(id).css('width', percentage + '%');

                if (percentage <= 25) {
                    className = 'bg-success';
                }

                if (percentage > 25 && percentage <= 75) {
                    className = 'bg-info';
                }

                if (percentage > 75 && percentage <= 90) {
                    className = 'bg-warning';
                }

                if (percentage > 90 && percentage <= 100) {
                    className = 'bg-danger';
                }

                $(id).removeClass();
                $(id).addClass('progress-bar ' + className);
            }

            $('#timespan').on('keyup', function () {
                progressBar()
            });

            var progressBar = function () {
                var timespan = $('#timespan').val();

                var totalDuration = 0;

                $('[name="bookmarks[]"]').each(function (i, el) {
                    if ($(el).prop('checked')) {
                        duration = $(el).attr('ml-duration');
                        totalDuration += parseInt(duration)
                    }
                });

                percentage = (totalDuration / timespan) * 100;
                drawProgressBar('#progressBar', percentage)
            }

            $('#addGoalForm').on('submit', function (e) {
               e.preventDefault();

                addGoal(this, function() {

                })
            });

            var addGoal = function(form, success) {
                url = baseUrl + 'goals';


                bookmarks = [];


                $(form).find('[name="bookmarks[]"]:checked').each(function (i, bm) {
                    bookmarks.push(parseInt($(bm).val()));
                })


                request = {
                    name: $(form).find('#name').val(),
                    timespan: $(form).find('#timespan').val(),
                    bookmarks: bookmarks
                }

                $.ajax({
                    type: "POST",
                    url: url,
                    success: success,
                    data: JSON.stringify(request),
                    dataType: 'json',
                    contentType: 'application/json'
                })
            }

        });
    </script>
  </body>
</html>
